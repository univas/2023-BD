#DDL - Data Definition Language

#Cuidado! Pois apaga todos os dados da tabela
DROP TABLE CORRENTISTA;

CREATE TABLE CORRENTISTA (
    CPF VARCHAR(11) NOT NULL,
    NOME VARCHAR(60) NOT NULL,
    EMAIL VARCHAR(70) NULL
);

#  \d    lista as tabelas

# \d CORRENTISTA    mostra os detalhes da tabela

#Modificar a estrutura da tabela

ALTER TABLE CORRENTISTA RENAME TO ACCOUNT_HOLDER;
ALTER TABLE ACCOUNT_HOLDER ADD COLUMN ENDERECO VARCHAR(200) NOT NULL;
ALTER TABLE ACCOUNT_HOLDER DROP COLUMN ENDERECO;
ALTER TABLE ACCOUNT_HOLDER RENAME COLUMN ENDERECO TO ADDRESS;

ALTER TABLE ACCOUNT_HOLDER ALTER COLUMN ADDRESS TYPE VARCHAR(150);

ALTER TABLE ACCOUNT_HOLDER ADD CONSTRAINT ACCOUNT_HOLDER_PK PRIMARY KEY (CPF);

#Voltando o nome da tabela e da coluna originais
ALTER TABLE ACCOUNT_HOLDER RENAME TO CORRENTISTA;
ALTER TABLE CORRENTISTA RENAME COLUMN ADDRESS TO ENDERECO;


CREATE TABLE CONTA (
    NUMERO INTEGER NOT NULL,
    SALDO NUMERIC(15,2) NOT NULL,
    CPF VARCHAR(11) NOT NULL
);
ALTER TABLE CONTA ADD CONSTRAINT CONTA_PK PRIMARY KEY (NUMERO);

CREATE TABLE CARTAO (
    NUMERO INTEGER NOT NULL,
    SENHA VARCHAR(15) NOT NULL,
    EMISSAO DATE NOT NULL,
    LIMITE FLOAT NULL,
    DATA_VALIDADE DATE NOT NULL,
    NUMERO_CONTA INTEGER NOT NULL,
    CPF VARCHAR(11) NOT NULL
);
ALTER TABLE CARTAO ADD CONSTRAINT CARTAO_PK PRIMARY KEY (NUMERO);


#Criando a chave estrangeira entre CONTA e CORRENTISTA

ALTER TABLE CONTA  ADD CONSTRAINT CORRENTISTA_FK FOREIGN KEY (CPF) REFERENCES CORRENTISTA(CPF);
ALTER TABLE CARTAO ADD CONSTRAINT CORRENTISTA_CARTAO_FK FOREIGN KEY (CPF) REFERENCES CORRENTISTA(CPF);
ALTER TABLE CARTAO DROP CONSTRAINT CORRENTISTA_CARTAO_FK;
ALTER TABLE CARTAO ADD CONSTRAINT CONTA_CARTAO_FK FOREIGN KEY (NUMERO_CONTA) REFERENCES CONTA(NUMERO);

#Observação: o cpf do cartão está diferente do cpf da conta. É necessario rever o modelo.
